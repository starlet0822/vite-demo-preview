import{aO as K,a as Q,e as W,r as C,g as B,n as X,f as Y,w as N,c as G,j as Z,b2 as ee,bf as te,C as ne,D as oe,k as q}from"./index-77d71d8d.js";import{g as S}from"./file-03a9a626.js";import{_ as re}from"./plugin-vueexport-helper-c27b6911.js";var A={exports:{}};(function(v,O){(function(b,d){v.exports=d()})(K,function(){return function(b){var d={};function s(a){if(d[a])return d[a].exports;var u=d[a]={i:a,l:!1,exports:{}};return b[a].call(u.exports,u,u.exports,s),u.l=!0,u.exports}return s.m=b,s.c=d,s.d=function(a,u,m){s.o(a,u)||Object.defineProperty(a,u,{enumerable:!0,get:m})},s.r=function(a){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s.t=function(a,u){if(1&u&&(a=s(a)),8&u||4&u&&typeof a=="object"&&a&&a.__esModule)return a;var m=Object.create(null);if(s.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:a}),2&u&&typeof a!="string")for(var y in a)s.d(m,y,function(_){return a[_]}.bind(null,y));return m},s.n=function(a){var u=a&&a.__esModule?function(){return a.default}:function(){return a};return s.d(u,"a",u),u},s.o=function(a,u){return Object.prototype.hasOwnProperty.call(a,u)},s.p="",s(s.s=0)}([function(b,d,s){var a;function u(o){return["image/png","image/jpeg","image/gif"].some(t=>t===o)}s.r(d),s.d(d,"canvastoDataURL",function(){return y}),s.d(d,"canvastoFile",function(){return _}),s.d(d,"dataURLtoFile",function(){return g}),s.d(d,"dataURLtoImage",function(){return P}),s.d(d,"downloadFile",function(){return x}),s.d(d,"filetoDataURL",function(){return z}),s.d(d,"imagetoCanvas",function(){return L}),s.d(d,"urltoBlob",function(){return F}),s.d(d,"urltoImage",function(){return T}),s.d(d,"compress",function(){return V}),s.d(d,"compressAccurately",function(){return H}),s.d(d,"EImageType",function(){return a}),function(o){o.PNG="image/png",o.JPEG="image/jpeg",o.GIF="image/gif"}(a||(a={}));var m=function(o,t,n,e){return new(n||(n=Promise))(function(c,l){function f(i){try{p(e.next(i))}catch(r){l(r)}}function h(i){try{p(e.throw(i))}catch(r){l(r)}}function p(i){var r;i.done?c(i.value):(r=i.value,r instanceof n?r:new n(function(w){w(r)})).then(f,h)}p((e=e.apply(o,t||[])).next())})};function y(o,t=.92,n=a.JPEG){return m(this,void 0,void 0,function*(){return u(n)||(n=a.JPEG),o.toDataURL(n,t)})}function _(o,t=.92,n=a.JPEG){return new Promise(e=>o.toBlob(c=>e(c),n,t))}var j=function(o,t,n,e){return new(n||(n=Promise))(function(c,l){function f(i){try{p(e.next(i))}catch(r){l(r)}}function h(i){try{p(e.throw(i))}catch(r){l(r)}}function p(i){var r;i.done?c(i.value):(r=i.value,r instanceof n?r:new n(function(w){w(r)})).then(f,h)}p((e=e.apply(o,t||[])).next())})};function g(o,t){return j(this,void 0,void 0,function*(){const n=o.split(",");let e=n[0].match(/:(.*?);/)[1];const c=atob(n[1]);let l=c.length;const f=new Uint8Array(l);for(;l--;)f[l]=c.charCodeAt(l);return u(t)&&(e=t),new Blob([f],{type:e})})}function P(o){return new Promise((t,n)=>{const e=new Image;e.onload=()=>t(e),e.onerror=()=>n(new Error("dataURLtoImage(): dataURL is illegal")),e.src=o})}function x(o,t){const n=document.createElement("a");n.href=window.URL.createObjectURL(o),n.download=t||Date.now().toString(36),document.body.appendChild(n);const e=document.createEvent("MouseEvents");e.initEvent("click",!1,!1),n.dispatchEvent(e),document.body.removeChild(n)}function z(o){return new Promise(t=>{const n=new FileReader;n.onloadend=e=>t(e.target.result),n.readAsDataURL(o)})}var J=function(o,t,n,e){return new(n||(n=Promise))(function(c,l){function f(i){try{p(e.next(i))}catch(r){l(r)}}function h(i){try{p(e.throw(i))}catch(r){l(r)}}function p(i){var r;i.done?c(i.value):(r=i.value,r instanceof n?r:new n(function(w){w(r)})).then(f,h)}p((e=e.apply(o,t||[])).next())})};function L(o,t={}){return J(this,void 0,void 0,function*(){const n=Object.assign({},t),e=document.createElement("canvas"),c=e.getContext("2d");let l,f;for(const h in n)Object.prototype.hasOwnProperty.call(n,h)&&(n[h]=Number(n[h]));if(n.scale){const h=n.scale>0&&n.scale<10?n.scale:1;f=o.width*h,l=o.height*h}else f=n.width||n.height*o.width/o.height||o.width,l=n.height||n.width*o.height/o.width||o.height;switch([5,6,7,8].some(h=>h===n.orientation)?(e.height=f,e.width=l):(e.height=l,e.width=f),n.orientation){case 3:c.rotate(180*Math.PI/180),c.drawImage(o,-e.width,-e.height,e.width,e.height);break;case 6:c.rotate(90*Math.PI/180),c.drawImage(o,0,-e.width,e.height,e.width);break;case 8:c.rotate(270*Math.PI/180),c.drawImage(o,-e.height,0,e.height,e.width);break;case 2:c.translate(e.width,0),c.scale(-1,1),c.drawImage(o,0,0,e.width,e.height);break;case 4:c.translate(e.width,0),c.scale(-1,1),c.rotate(180*Math.PI/180),c.drawImage(o,-e.width,-e.height,e.width,e.height);break;case 5:c.translate(e.width,0),c.scale(-1,1),c.rotate(90*Math.PI/180),c.drawImage(o,0,-e.width,e.height,e.width);break;case 7:c.translate(e.width,0),c.scale(-1,1),c.rotate(270*Math.PI/180),c.drawImage(o,-e.height,0,e.height,e.width);break;default:c.drawImage(o,0,0,e.width,e.height)}return e})}function F(o){return fetch(o).then(t=>t.blob())}function T(o){return new Promise((t,n)=>{const e=new Image;e.onload=()=>t(e),e.onerror=()=>n(new Error("urltoImage(): Image failed to load, please check the image URL")),e.src=o})}var U=function(o,t,n,e){return new(n||(n=Promise))(function(c,l){function f(i){try{p(e.next(i))}catch(r){l(r)}}function h(i){try{p(e.throw(i))}catch(r){l(r)}}function p(i){var r;i.done?c(i.value):(r=i.value,r instanceof n?r:new n(function(w){w(r)})).then(f,h)}p((e=e.apply(o,t||[])).next())})};function V(o,t={}){return U(this,void 0,void 0,function*(){if(!(o instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");if(typeof t!="object"&&(t=Object.assign({quality:t})),t.quality=Number(t.quality),Number.isNaN(t.quality))return o;const n=yield z(o);let e=n.split(",")[0].match(/:(.*?);/)[1],c=a.JPEG;u(t.type)&&(c=t.type,e=t.type);const l=yield P(n),f=yield L(l,Object.assign({},t)),h=yield y(f,t.quality,c),p=yield g(h,e);return p.size>o.size?o:p})}function H(o,t={}){return U(this,void 0,void 0,function*(){if(!(o instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");if(typeof t!="object"&&(t=Object.assign({size:t})),t.size=Number(t.size),Number.isNaN(t.size)||1024*t.size>o.size)return o;t.accuracy=Number(t.accuracy),(!t.accuracy||t.accuracy<.8||t.accuracy>.99)&&(t.accuracy=.95);const n=t.size*(2-t.accuracy)*1024,e=1024*t.size,c=t.size*t.accuracy*1024,l=yield z(o);let f=l.split(",")[0].match(/:(.*?);/)[1],h=a.JPEG;u(t.type)&&(h=t.type,f=t.type);const p=yield P(l),i=yield L(p,Object.assign({},t));let r,w=.5;const M=[null,null];for(let I=1;I<=7;I++){r=yield y(i,w,h);const E=.75*r.length;if(I===7){(n<E||c>E)&&(r=[r,...M].filter(k=>k).sort((k,$)=>Math.abs(.75*k.length-e)-Math.abs(.75*$.length-e))[0]);break}if(n<E)M[1]=r,w-=Math.pow(.5,I+1);else{if(!(c>E))break;M[0]=r,w+=Math.pow(.5,I+1)}}const R=yield g(r,f);return R.size>o.size?o:R})}}])})})(A);var ae=A.exports,ce=ae;const D=v=>(ne("data-v-7f46cc12"),v=v(),oe(),v),ie={class:"demo-compress"},se=D(()=>q("img",{src:"https://cube.elemecdn.com/e/fd/0fc7d20532fdaf769a25683617711png.png"},null,-1)),ue=D(()=>q("span",{class:"demonstration"}," 压缩后的头像图片 ",-1)),le=2,de=Q({__name:"Compress",setup(v){const O=W(),b=[".jpeg",".png",".jpg"],d=m=>b.length&&!b.includes(m.name.substr(m.name.lastIndexOf(".")))?(ee.error(`上像图片只支持${b.join()}格式文件`),!1):new Promise((y,_)=>{const j=m.size>le*1024*1024,g=new Image;g.onload=()=>{m.width=g.width,m.height=g.height,g.width>100||j?ce.compressAccurately(m,{size:1024,width:100,height:100}).then(x=>{y(x),O.value=S(x)}):y(te)},g.src=S(m)}),s=m=>{},a=()=>!0,u=()=>{};return(m,y)=>{const _=C("el-button"),j=C("el-upload"),g=C("el-avatar");return B(),X("div",ie,[(B(),Y(j,{key:0,ref:"upload",action:"/",accept:".jpg, .jpeg",limit:1,"before-upload":d,"on-change":s,"show-file-list":!1,"http-request":u},{trigger:N(()=>[G(_,{type:"primary"},{default:N(()=>[Z("上传头像")]),_:1})]),_:1},512)),G(g,{class:"mt-4",size:100,src:O.value,onError:a},{default:N(()=>[se]),_:1},8,["src"]),ue])}}});const me=re(de,[["__scopeId","data-v-7f46cc12"]]);export{me as default};
