import U from"./PluginConfig-a0d97f5a.js";import{aM as E,aN as L,aO as Z,aP as G,aQ as D,aR as O,aS as I,aT as M,d as z,q as X,f as c,b as p,g as x,_ as F,aU as j,ap as J,S as W,G as V,c as A,w as u,e as d,aV as $,j as m,a0 as C,F as w,H as ee,h as v,v as _,B as te,m as ie}from"./index-23cd956f.js";import{o as ne}from"./omit-03f999b5.js";function ae(i,t){var n=i.length;for(i.sort(t);n--;)i[n]=i[n].value;return i}function le(i,t){if(i!==t){var n=i!==void 0,o=i===null,l=i===i,a=E(i),r=t!==void 0,y=t===null,g=t===t,h=E(t);if(!y&&!h&&!a&&i>t||a&&r&&g&&!y&&!h||o&&r&&g||!n&&g||!l)return 1;if(!o&&!a&&!h&&i<t||h&&n&&l&&!o&&!a||y&&n&&l||!r&&l||!g)return-1}return 0}function oe(i,t,n){for(var o=-1,l=i.criteria,a=t.criteria,r=l.length,y=n.length;++o<r;){var g=le(l[o],a[o]);if(g){if(o>=y)return g;var h=n[o];return g*(h=="desc"?-1:1)}}return i.index-t.index}function re(i,t,n){t.length?t=L(t,function(a){return D(a)?function(r){return O(r,a.length===1?a[0]:a)}:a}):t=[Z];var o=-1;t=L(t,I(M));var l=G(i,function(a,r,y){var g=L(t,function(h){return h(a)});return{criteria:g,index:++o,value:a}});return ae(l,function(a,r){return oe(a,r,n)})}function q(i,t,n,o){return i==null?[]:(D(t)||(t=t==null?[]:[t]),n=o?void 0:n,D(n)||(n=n==null?[]:[n]),re(i,t,n))}const se=z({name:"PanelSection",props:{title:{type:String,required:!0},customStyle:{type:[Object,String],default:()=>({})},id:{type:String,default:""},tooltip:{type:String,default:""}},setup(i,{slots:t}){const{id:n,title:o,tooltip:l,customStyle:a}=X(i);return()=>{var r;return c("div",{class:"panel-section",id:n.value},[c(p("el-divider"),{"content-position":"left",class:"mt-6"},{default:()=>[c("span",{class:"font-title"},[o.value,x(" "),l.value&&c(p("el-tooltip"),null,{default:()=>[c("i",{class:"el-icon-question"},null)]})])]}),c("div",{style:a.value},[(r=t==null?void 0:t.default)==null?void 0:r.call(t)])])}}});const ce=F(se,[["__scopeId","data-v-0fafcbd5"]]),e={authentication:"authentication",security:"security",traffic:"traffic",serverless:"serverless",observability:"observability",other:"other"},ue={authentication:"身份验证",security:"安全防护",traffic:"流量控制",serverless:"无服务器架构",observability:"可观测性",other:"其它"},H={"api-breaker":{type:e.security},"authz-casbin":{type:e.authentication},"authz-casdoor":{type:e.authentication},"authz-keycloak":{type:e.authentication},"aws-lambda":{type:e.serverless},"azure-functions":{type:e.serverless},"basic-auth":{type:e.authentication},"batch-requests":{type:e.other,hidden:!0},"clickhouse-logger":{type:e.observability},"client-control":{type:e.traffic},"consumer-restriction":{type:e.security},cors:{type:e.security},csrf:{type:e.security},datadog:{type:e.observability},"dubbo-proxy":{type:e.other,hidden:!0},echo:{type:e.other,hidden:!0},"error-log-logger":{type:e.observability,hidden:!0},"example-plugin":{type:e.other,hidden:!0},"ext-plugin-post-req":{type:e.other},"ext-plugin-post-resp":{type:e.other},"ext-plugin-pre-req":{type:e.other},"fault-injection":{type:e.security},"file-logger":{type:e.observability},"forward-auth":{type:e.authentication},"google-cloud-logging":{type:e.observability},"grpc-transcode":{type:e.other},"grpc-web":{type:e.other},gzip:{type:e.other},"hmac-auth":{type:e.authentication},"http-logger":{type:e.observability},"ip-restriction":{type:e.security},"jwt-auth":{type:e.authentication},"kafka-logger":{type:e.observability},"kafka-proxy":{type:e.other},"key-auth":{type:e.authentication},"ldap-auth":{type:e.authentication},"limit-conn":{type:e.traffic},"limit-count":{type:e.traffic},"limit-req":{type:e.traffic},loggly:{type:e.observability},"log-rotate":{type:e.observability,hidden:!0},mocking:{type:e.other},"node-status":{type:e.other,hidden:!0},opa:{type:e.authentication},"openid-connect":{type:e.authentication},opentelemetry:{type:e.observability},openwhisk:{type:e.serverless},prometheus:{type:e.observability},"proxy-cache":{type:e.other},"proxy-control":{type:e.other},"proxy-mirror":{type:e.other},"proxy-rewrite":{type:e.other},"public-api":{type:e.security},"real-ip":{type:e.other},redirect:{type:e.other,hidden:!0},"referer-restriction":{type:e.security},"request-id":{type:e.observability},"request-validation":{type:e.security},"response-rewrite":{type:e.other},"rocketmq-logger":{type:e.observability},"server-info":{type:e.other,hidden:!0},"serverless-post-function":{type:e.serverless},"serverless-pre-function":{type:e.serverless},skywalking:{type:e.observability},"skywalking-logger":{type:e.observability},"sls-logger":{type:e.observability},"splunk-hec-logging":{type:e.observability},syslog:{type:e.observability},"tcp-logger":{type:e.observability},"traffic-split":{type:e.traffic},"ua-restriction":{type:e.security},"udp-logger":{type:e.observability},"uri-blocker":{type:e.security},"wolf-rbac":{type:e.authentication},zipkin:{type:e.observability},"mqtt-proxy":{type:e.other,hidden:!0},"elasticsearch-logger":{type:e.observability},openfunction:{type:e.serverless},"tencent-cloud-cls":{type:e.observability},ai:{type:e.other},"cas-auth":{type:e.authentication}},pe="data:image/png;base64,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",ge=()=>j.request("get","/getPlugins");const ye={name:"PluginPage",components:{PanelSection:ce,PluginConfig:U},props:{readonly:Boolean,type:{type:String,default:"scoped"},initialData:{type:Object,default:()=>({})},pluginConfigId:{type:String,default:""},schemaType:{type:String,default:"route"},referPage:{type:String,default:""},showSelector:Boolean,onChange:{type:Function,default:()=>()=>{}}},data(){return{orderBy:q,defaultImg:pe,showEnablePlugin:"all",tabActive:"authentication",PluginTitle:ue,typeList:[],pluginList:[],cachedPluginList:[],enablePluginsList:[],plugins:this.initialData,showPluginConfig:!1,pluginConfig:{name:"",type:"global",item:{}},loading:!1,keyword:"",queryList:[],navs:[],sections:[],scrollTop:0}},computed:{cluster_id(){return this.$route.params.etcdId},workspace_id(){return this.$route.params.workId},panelSectionStyle(){return Object.freeze({display:"grid","grid-template-columns":"repeat(4, 1fr)",gap:"24px"})},showTabs(){return this.scrollTop>120}},async mounted(){await this.getPluginPage(),await this.$nextTick(),this.navs=document.querySelectorAll(".el-tabs__item"),this.sections=document.querySelectorAll(".panel-section");const i=document.querySelector(".app-main .el-scrollbar__wrap");J(i,"scroll",t=>{this.scrollTop=t.target.scrollTop,this.onScroll(t.target.scrollTop)})},beforeUnmount(){},methods:{async getPluginPage(){try{this.loading=!0;const{success:i,data:t}=await ge();if(i){const n=t.map(l=>{var a,r;return{...l,type:((a=H[l.name])==null?void 0:a.type)||"other",originType:l.type,hidden:((r=H[l.name])==null?void 0:r.hidden)||!1}});let o=[];Object.values(e).forEach(l=>{o=o.concat(n.filter(a=>a.type===l))}),this.cachedPluginList=this.pluginList=o,this.getTypeList(o)}}finally{this.loading=!1}},getTypeList(i){const t=[];i.forEach(n=>{t.includes(n.type)||t.push(n.type)}),this.typeList=t},handlePluginList(i){const t=(this.showEnablePlugin==="enable"?this.enablePluginsList:this.pluginList).filter(this.readonly?n=>n.type===i&&!n.hidden&&this.initialData[n.name]:n=>n.type===i&&!n.hidden);return q(t,"name","asc")},async handlePluginConfigChange({formValues:i,codeData:t,shouldDelete:n}){const o=this.pluginConfig.name;let l={...this.initialData,[o]:{...t,disable:!i.disable}},a="edit";n===!0&&(a="delete",l=ne(this.plugins,o)),this.onChange(l,a),this.plugins=l,this.handleCloseDrawer()},onClickConfig(i){this.pluginConfig.name=i.name},async onClickDisabled(i){},handleCloseDrawer(){},handleClickBtns(i,t){const{name:n}=i;switch(n){case"enable":this.pluginConfig.name=t.name,this.showPluginConfig=!0;break}},onTabClick(i){this.scrollToSection(`${i.paneName}`)},remoteMethod(i){i!==""?this.queryList=this.cachedPluginList.filter(t=>t.name.toLowerCase().indexOf(i.toLowerCase())>-1):this.queryList=[]},handleQueryChange(i){const t=[...this.cachedPluginList];this.pluginList=i?t.filter(n=>n.name.toLowerCase().indexOf(i.toLowerCase())>-1):t},querySearch(i,t){const n=a=>r=>new RegExp(a,"gi").test(r.value),o=this.pluginList.map(a=>({...a,value:a.name,address:a.name})),l=i?o.filter(n(i)):o;t(l)},scrollToSection(i){const t=document.getElementById(i);t==null||t.scrollIntoView({behavior:"smooth"})},onScroll(i){var t;(t=this.sections)==null||t.forEach(n=>{const o=n.offsetTop,l=window.innerHeight/2;i>=o-l&&this.navs.forEach(a=>{const r=a.getAttribute("id").replace("tab-",""),y=n.getAttribute("id");r===y&&(this.tabActive=r)})})}}},de={class:"plugin-list"},he={class:"truncate text-center"},fe={class:"flex-c flex-1"};function Ae(i,t,n,o,l,a){const r=p("el-tab-pane"),y=p("el-tabs"),g=p("el-option"),h=p("el-select"),S=p("el-col"),k=p("el-row"),K=p("el-image"),P=p("el-button"),Q=p("el-card"),Y=p("PanelSection"),N=p("plugin-config"),R=W("loading");return V((d(),A(Q,{shadow:"never",class:"plugin-page"},{default:u(()=>[(d(),A($,{to:"body"},[V(c(y,{ref:"tabsRef",modelValue:l.tabActive,"onUpdate:modelValue":t[0]||(t[0]=s=>l.tabActive=s),style:{position:"fixed",top:"170px",right:"40px"},"tab-position":"left",onTabClick:a.onTabClick},{default:u(()=>[(d(!0),m(w,null,C(l.typeList,s=>(d(),A(r,{key:s,name:s,label:l.PluginTitle[s]},null,8,["name","label"]))),128))]),_:1},8,["modelValue","onTabClick"]),[[ee,a.showTabs]])])),v("div",de,[c(k,{type:"flex",align:"middle",gutter:16},{default:u(()=>[c(S,{xs:24,sm:24,md:12,lg:8,xl:6},{default:u(()=>[c(h,{modelValue:l.keyword,"onUpdate:modelValue":t[1]||(t[1]=s=>l.keyword=s),filterable:"",remote:"",clearable:"","reserve-keyword":"",placeholder:"搜索插件",style:{width:"100%"},"remote-method":a.remoteMethod,onChange:a.handleQueryChange},{default:u(()=>[(d(!0),m(w,null,C(l.queryList,s=>(d(),A(g,{key:s.name,label:s.name,value:s.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue","remote-method","onChange"])]),_:1})]),_:1}),(d(!0),m(w,null,C(l.typeList,s=>(d(),A(Y,{key:s,id:`${s}`,title:l.PluginTitle[s]},{default:u(()=>[c(k,{gutter:16},{default:u(()=>[(d(!0),m(w,null,C(a.handlePluginList(s),f=>(d(),A(S,{xs:24,sm:24,md:12,lg:8,xl:6,key:f.name},{default:u(()=>[c(Q,{class:"mb-4",shadow:"hover","body-style":{minHeight:"301px",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",width:"100%"}},{header:u(()=>[v("div",he,[v("span",null,_(f.name),1)])]),default:u(()=>[v("div",fe,[c(K,{src:l.defaultImg,style:{width:"50px",height:"50px",opacity:.2,display:"block"}},null,8,["src"])]),c(k,{class:"w-full",type:"flex",justify:"center"},{default:u(()=>{var B,T;return[c(P,{type:n.initialData[f.name]&&!((B=n.initialData[f.name])!=null&&B.disable)?"primary":"default",onClick:b=>a.onClickConfig(f)},{default:u(()=>{var b;return[x(_(n.initialData[f.name]&&!((b=n.initialData[f.name])!=null&&b.disable)?"更 新":"启 用"),1)]}),_:2},1032,["type","onClick"]),n.initialData[f.name]&&!((T=n.initialData[f.name])!=null&&T.disable)?(d(),A(P,{key:0,type:"danger",onClick:b=>a.onClickDisabled(f)},{default:u(()=>[x(_("禁 用"))]),_:2},1032,["onClick"])):te("",!0)]}),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["id","title"]))),128))]),c(N,ie(l.pluginConfig,{modelValue:l.showPluginConfig,"onUpdate:modelValue":t[2]||(t[2]=s=>l.showPluginConfig=s),"initial-data":n.initialData,"plugin-list":l.pluginList,"on-change":a.handlePluginConfigChange,onCloseDrawer:a.handleCloseDrawer}),null,16,["modelValue","initial-data","plugin-list","on-change","onCloseDrawer"])]),_:1})),[[R,l.loading]])}const we=F(ye,[["render",Ae],["__scopeId","data-v-958e69b6"]]);export{we as default};
