import{Z as J,d as Q,c4 as p,$ as j,r as ee,cv as ce,a as R,c as H,w as Y,cw as re,p as r,cx as A,ax as y,cm as me,ak as ue,cy as oe,cz as q,cA as ve,ap as ge,o as de,cB as fe,cC as he,B as we,m as te,au as Pe,W as xe,at as M,as as Se,av as W,a0 as U,ar as G,ce as ye,X as Ie,ct as Ce,c9 as Te,_ as be,cD as Xe,cE as Ye}from"./index-5560da19.js";import{S as Ze,a as Re}from"./index-9a989bb3.js";import{I as ze}from"./index-4ff7e532.js";const K=o=>Math.sqrt((o[0].clientX-o[1].clientX)**2+(o[0].clientY-o[1].clientY)**2),De=o=>({x:(o[0].clientX+o[1].clientX)/2,y:(o[0].clientY+o[1].clientY)/2}),B=J("image-preview")[1],V=2.6;var pe=Q({props:{src:String,show:Boolean,active:Number,minZoom:p(j),maxZoom:p(j),rootWidth:p(Number),rootHeight:p(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(o,{emit:c,slots:m}){const e=ee({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),s=ce(),I=R(),z=R(),w=R(!1),g=R(!1);let P=0;const _=H(()=>{const{scale:t,moveX:a,moveY:i,moving:l,zooming:v,initializing:b}=e,D={transitionDuration:v||l||b?"0s":".3s"};return(t!==1||g.value)&&(D.transform=`matrix(${t}, 0, 0, ${t}, ${a}, ${i})`),D}),u=H(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:a}=o,i=w.value?a/e.imageRatio:t;return Math.max(0,(e.scale*i-t)/2)}return 0}),f=H(()=>{if(e.imageRatio){const{rootWidth:t,rootHeight:a}=o,i=w.value?a:t*e.imageRatio;return Math.max(0,(e.scale*i-a)/2)}return 0}),C=(t,a)=>{var i;if(t=y(t,+o.minZoom,+o.maxZoom+1),t!==e.scale){const l=t/e.scale;if(e.scale=t,a){const v=oe((i=I.value)==null?void 0:i.$el),b={x:v.width*.5,y:v.height*.5},D=e.moveX-(a.x-v.left-b.x)*(l-1),le=e.moveY-(a.y-v.top-b.y)*(l-1);e.moveX=y(D,-u.value,u.value),e.moveY=y(le,-f.value,f.value)}else e.moveX=0,e.moveY=g.value?P:0;c("scale",{scale:t,index:o.active})}},T=()=>{C(1)},$=()=>{const t=e.scale>1?1:2;C(t,t===2||g.value?{x:s.startX.value,y:s.startY.value}:void 0)};let x,S,n,d,h,N,Z,L,k=!1;const ae=t=>{const{touches:a}=t;if(x=a.length,x===2&&o.disableZoom)return;const{offsetX:i}=s;s.start(t),S=e.moveX,n=e.moveY,L=Date.now(),k=!1,e.moving=x===1&&(e.scale!==1||g.value),e.zooming=x===2&&!i.value,e.zooming&&(d=e.scale,h=K(a))},se=t=>{const{touches:a}=t;if(s.move(t),e.moving){const{deltaX:i,deltaY:l}=s,v=i.value+S,b=l.value+n;if((v>u.value||v<-u.value)&&!k&&s.isHorizontal()){e.moving=!1;return}k=!0,A(t,!0),e.moveX=y(v,-u.value,u.value),e.moveY=y(b,-f.value,f.value)}if(e.zooming&&(A(t,!0),a.length===2)){const i=K(a),l=d*i/h;N=De(a),C(l,N)}},ie=()=>{if(x>1)return;const{offsetX:t,offsetY:a}=s,i=Date.now()-L,l=250;t.value<q&&a.value<q&&(i<l?Z?(clearTimeout(Z),Z=null,$()):Z=setTimeout(()=>{c("close"),Z=null},l):i>ve&&c("longPress"))},O=t=>{let a=!1;if((e.moving||e.zooming)&&(a=!0,e.moving&&S===e.moveX&&n===e.moveY&&(a=!1),!t.touches.length)){e.zooming&&(e.moveX=y(e.moveX,-u.value,u.value),e.moveY=y(e.moveY,-f.value,f.value),e.zooming=!1),e.moving=!1,S=0,n=0,d=1,e.scale<1&&T();const i=+o.maxZoom;e.scale>i&&C(i,N)}A(t,a),ie(),s.reset()},F=()=>{const{rootWidth:t,rootHeight:a}=o,i=a/t,{imageRatio:l}=e;w.value=e.imageRatio>i&&l<V,g.value=e.imageRatio>i&&l>=V,g.value&&(P=(l*t-a)/2,e.moveY=P,e.initializing=!0,me(()=>{e.initializing=!1})),T()},ne=t=>{const{naturalWidth:a,naturalHeight:i}=t.target;e.imageRatio=i/a,F()};return Y(()=>o.active,T),Y(()=>o.show,t=>{t||T()}),Y(()=>[o.rootWidth,o.rootHeight],F),re("touchmove",se,{target:H(()=>{var t;return(t=z.value)==null?void 0:t.$el})}),()=>{const t={loading:()=>r(ue,{type:"spinner"},null)};return r(Ze,{ref:z,class:B("swipe-item"),onTouchstartPassive:ae,onTouchend:O,onTouchcancel:O},{default:()=>[m.image?r("div",{class:B("image-wrap")},[m.image({src:o.src})]):r(ze,{ref:I,src:o.src,fit:"contain",class:B("image",{vertical:w.value}),style:_.value,onLoad:ne},t)]})}}});const[He,X]=J("image-preview"),Me=["show","teleport","transition","overlayStyle","closeOnPopstate"],We={show:Boolean,loop:M,images:Se(),minZoom:W(1/3),maxZoom:W(3),overlay:M,closeable:Boolean,showIndex:M,className:U,closeIcon:G("clear"),transition:String,beforeClose:Function,overlayClass:U,overlayStyle:Object,swipeDuration:W(300),startPosition:W(0),showIndicators:Boolean,closeOnPopstate:M,closeIconPosition:G("top-right"),teleport:[String,Object]};var Ee=Q({name:He,props:We,emits:["scale","close","closed","change","longPress","update:show"],setup(o,{emit:c,slots:m}){const e=R(),s=ee({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),I=()=>{if(e.value){const n=oe(e.value.$el);s.rootWidth=n.width,s.rootHeight=n.height,e.value.resize()}},z=n=>c("scale",n),w=n=>c("update:show",n),g=()=>{Ce(o.beforeClose,{args:[s.active],done:()=>w(!1)})},P=n=>{n!==s.active&&(s.active=n,c("change",n))},_=()=>{if(o.showIndex)return r("div",{class:X("index")},[m.index?m.index({index:s.active}):`${s.active+1} / ${o.images.length}`])},u=()=>{if(m.cover)return r("div",{class:X("cover")},[m.cover()])},f=()=>{s.disableZoom=!0},C=()=>{s.disableZoom=!1},T=()=>r(Re,{ref:e,lazyRender:!0,loop:o.loop,class:X("swipe"),duration:o.swipeDuration,initialSwipe:o.startPosition,showIndicators:o.showIndicators,indicatorColor:"white",onChange:P,onDragEnd:C,onDragStart:f},{default:()=>[o.images.map((n,d)=>r(pe,{src:n,show:o.show,active:s.active,maxZoom:o.maxZoom,minZoom:o.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,disableZoom:s.disableZoom,onScale:z,onClose:g,onLongPress:()=>c("longPress",{index:d})},{image:m.image}))]}),$=()=>{if(o.closeable)return r(Ie,{role:"button",name:o.closeIcon,class:[X("close-icon",o.closeIconPosition),ye],onClick:g},null)},x=()=>c("closed"),S=(n,d)=>{var h;return(h=e.value)==null?void 0:h.swipeTo(n,d)};return ge({swipeTo:S}),de(I),Y([fe,he],I),Y(()=>o.startPosition,n=>P(+n)),Y(()=>o.show,n=>{const{images:d,startPosition:h}=o;n?(P(+h),we(()=>{I(),S(+h,{immediate:!0})})):c("close",{index:s.active,url:d[s.active]})}),()=>r(xe,te({class:[X(),o.className],overlayClass:[X("overlay"),o.overlayClass],onClosed:x,"onUpdate:show":w},Pe(o,Me)),{default:()=>[$(),T(),_(),u()]})}});let E;const _e={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function $e(){({instance:E}=Xe({setup(){const{state:o,toggle:c}=Ye(),m=()=>{o.images=[]};return()=>r(Ee,te(o,{onClosed:m,"onUpdate:show":c}),null)}}))}const Be=(o,c=0)=>{if(Te)return E||$e(),o=Array.isArray(o)?{images:o,startPosition:c}:o,E.open(be({},_e,o)),E};export{Be as s};
