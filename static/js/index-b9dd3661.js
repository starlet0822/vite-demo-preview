import{Z as R,cs as pe,_ as C,ax as $,d as A,$ as L,c4 as N,as as D,a as E,cv as Oe,c as k,a1 as le,ap as ce,e as ke,cw as ie,p as m,cx as se,ce as W,av as V,ao as ue,au as X,at as ye,ar as Ce,cX as we,w as z,cF as G,ak as Pe,B as ee,m as Ee,d6 as Se,a3 as Ie,d7 as re}from"./index-5560da19.js";import{u as Be}from"./use-sync-prop-ref-d69e1c72.js";import{a as De,T as Me}from"./index-e2b6ecb5.js";const[He,x,te]=R("picker"),de=e=>e.find(a=>!a.disabled)||e[0];function Ne(e,a){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(a.children in n)return"cascade"}return"default"}function _(e,a){a=$(a,0,e.length);for(let n=a;n<e.length;n++)if(!e[n].disabled)return n;for(let n=a-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const ne=(e,a,n)=>a!==void 0&&!!e.find(c=>c[n.value]===a);function J(e,a,n){const c=e.findIndex(d=>d[n.value]===a),l=_(e,c);return e[l]}function Ve(e,a,n){const c=[];let l={[a.children]:e},d=0;for(;l&&l[a.children];){const r=l[a.children],v=n.value[d];if(l=pe(v)?J(r,v,a):void 0,!l&&r.length){const u=de(r)[a.value];l=J(r,u,a)}d++,c.push(r)}return c}function _e(e){const{transform:a}=window.getComputedStyle(e),n=a.slice(7,a.length-1).split(", ")[5];return Number(n)}function $e(e){return C({text:"text",value:"value",children:"children"},e)}const ae=200,oe=300,Re=15,[me,Z]=R("picker-column"),fe=Symbol(me);var Ae=A({name:me,props:{value:L,fields:N(Object),options:D(),readonly:Boolean,allowHtml:Boolean,optionHeight:N(Number),swipeDuration:N(L),visibleOptionNum:N(L)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:n}){let c,l,d,r,v;const u=E(),g=E(),f=E(0),h=E(0),b=Oe(),p=()=>e.options.length,M=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,y=s=>{let t=_(e.options,s);const o=-t*e.optionHeight,i=()=>{t>p()-1&&(t=_(e.options,s));const O=e.options[t][e.fields.value];O!==e.value&&a("change",O)};c&&o!==f.value?v=i:i(),f.value=o},T=()=>e.readonly||!e.options.length,K=s=>{c||T()||(v=null,h.value=ae,y(s),a("clickOption",e.options[s]))},w=s=>$(Math.round(-s/e.optionHeight),0,p()-1),H=k(()=>w(f.value)),U=(s,t)=>{const o=Math.abs(s/t);s=f.value+o/.003*(s<0?-1:1);const i=w(s);h.value=+e.swipeDuration,y(i)},S=()=>{c=!1,h.value=0,v&&(v(),v=null)},Y=s=>{if(!T()){if(b.start(s),c){const t=_e(g.value);f.value=Math.min(0,t-M())}h.value=0,l=f.value,d=Date.now(),r=l,v=null}},j=s=>{if(T())return;b.move(s),b.isVertical()&&(c=!0,se(s,!0));const t=$(l+b.deltaY.value,-(p()*e.optionHeight),e.optionHeight),o=w(t);o!==H.value&&a("scrollInto",e.options[o]),f.value=t;const i=Date.now();i-d>oe&&(d=i,r=t)},I=()=>{if(T())return;const s=f.value-r,t=Date.now()-d;if(t<oe&&Math.abs(s)>Re){U(s,t);return}const i=w(f.value);h.value=ae,y(i),setTimeout(()=>{c=!1},0)},P=()=>{const s={height:`${e.optionHeight}px`};return e.options.map((t,o)=>{const i=t[e.fields.text],{disabled:O}=t,B=t[e.fields.value],Te={role:"button",style:s,tabindex:O?-1:0,class:[Z("item",{disabled:O,selected:B===e.value}),t.className],onClick:()=>K(o)},xe={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:i};return m("li",Te,[n.option?n.option(t,o):m("div",xe,null)])})};return le(fe),ce({stopMomentum:S}),ke(()=>{const s=c?Math.floor(-f.value/e.optionHeight):e.options.findIndex(i=>i[e.fields.value]===e.value),t=_(e.options,s),o=-t*e.optionHeight;c&&t<s&&S(),f.value=o}),ie("touchmove",j,{target:u}),()=>m("div",{ref:u,class:Z(),onTouchstartPassive:Y,onTouchend:I,onTouchcancel:I},[m("ul",{ref:g,style:{transform:`translate3d(0, ${f.value+M()}px, 0)`,transitionDuration:`${h.value}ms`,transitionProperty:h.value?"all":"none"},class:Z("wrapper"),onTransitionend:S},[P()])])}});const[Fe]=R("picker-toolbar"),F={title:String,cancelButtonText:String,confirmButtonText:String},ve=["cancel","confirm","title","toolbar"],Ke=Object.keys(F);var he=A({name:Fe,props:F,emits:["confirm","cancel"],setup(e,{emit:a,slots:n}){const c=()=>{if(n.title)return n.title();if(e.title)return m("div",{class:[x("title"),"van-ellipsis"]},[e.title])},l=()=>a("cancel"),d=()=>a("confirm"),r=()=>{const u=e.cancelButtonText||te("cancel");return m("button",{type:"button",class:[x("cancel"),W],onClick:l},[n.cancel?n.cancel():u])},v=()=>{const u=e.confirmButtonText||te("confirm");return m("button",{type:"button",class:[x("confirm"),W],onClick:d},[n.confirm?n.confirm():u])};return()=>m("div",{class:x("toolbar")},[n.toolbar?n.toolbar():[r(),c(),v()]])}});const[ge,q]=R("picker-group"),be=Symbol(ge),Ue=C({tabs:D(),activeTab:V(0),nextStepText:String},F);A({name:ge,props:Ue,emits:["confirm","cancel","update:activeTab"],setup(e,{emit:a,slots:n}){const c=Be(()=>e.activeTab,g=>a("update:activeTab",g)),{children:l,linkChildren:d}=ue(be);d();const r=()=>+c.value<e.tabs.length-1&&e.nextStepText,v=()=>{r()?c.value=+c.value+1:a("confirm",l.map(g=>g.confirm()))},u=()=>a("cancel");return()=>{var g;const f=(g=n.default)==null?void 0:g.call(n),h=r()?e.nextStepText:e.confirmButtonText;return m("div",{class:q()},[m(he,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:h,onConfirm:v,onCancel:u},X(n,ve)),m(De,{active:c.value,"onUpdate:active":b=>c.value=b,class:q("tabs"),shrink:!0,animated:!0,lazyRender:!1},{default:()=>[e.tabs.map((b,p)=>m(Me,{title:b,titleClass:q("tab-title")},{default:()=>[f==null?void 0:f[p]]}))]})])}}});const Q=C({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:V(44),showToolbar:ye,swipeDuration:V(1e3),visibleOptionNum:V(6)},F),Ye=C({},Q,{columns:D(),modelValue:D(),toolbarPosition:Ce("top"),columnsFieldNames:Object});var je=A({name:He,props:Ye,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:n}){const c=E(),l=E(e.modelValue.slice(0)),{parent:d}=le(be),{children:r,linkChildren:v}=ue(fe);v();const u=k(()=>$e(e.columnsFieldNames)),g=k(()=>we(e.optionHeight)),f=k(()=>Ne(e.columns,u.value)),h=k(()=>{const{columns:t}=e;switch(f.value){case"multiple":return t;case"cascade":return Ve(t,u.value,l);default:return[t]}}),b=k(()=>h.value.some(t=>t.length)),p=k(()=>h.value.map((t,o)=>J(t,l.value[o],u.value))),M=k(()=>h.value.map((t,o)=>t.findIndex(i=>i[u.value.value]===l.value[o]))),y=(t,o)=>{if(l.value[t]!==o){const i=l.value.slice(0);i[t]=o,l.value=i}},T=()=>({selectedValues:l.value.slice(0),selectedOptions:p.value,selectedIndexes:M.value}),K=(t,o)=>{y(o,t),f.value==="cascade"&&l.value.forEach((i,O)=>{const B=h.value[O];ne(B,i,u.value)||y(O,B.length?B[0][u.value.value]:void 0)}),ee(()=>{a("change",C({columnIndex:o},T()))})},w=(t,o)=>{const i={columnIndex:o,currentOption:t};a("clickOption",C(T(),i)),a("scrollInto",i)},H=()=>{r.forEach(o=>o.stopMomentum());const t=T();return ee(()=>{a("confirm",t)}),t},U=()=>a("cancel",T()),S=()=>h.value.map((t,o)=>m(Ae,{value:l.value[o],fields:u.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:g.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:i=>K(i,o),onClickOption:i=>w(i,o),onScrollInto:i=>{a("scrollInto",{currentOption:i,columnIndex:o})}},{option:n.option})),Y=t=>{if(b.value){const o={height:`${g.value}px`},i={backgroundSize:`100% ${(t-g.value)/2}px`};return[m("div",{class:x("mask"),style:i},null),m("div",{class:[Se,x("frame")],style:o},null)]}},j=()=>{const t=g.value*+e.visibleOptionNum,o={height:`${t}px`};return m("div",{ref:c,class:x("columns"),style:o},[S(),Y(t)])},I=()=>{if(e.showToolbar&&!d)return m(he,Ee(X(e,Ke),{onConfirm:H,onCancel:U}),X(n,ve))};z(h,t=>{t.forEach((o,i)=>{o.length&&!ne(o,l.value[i],u.value)&&y(i,de(o)[u.value.value])})},{immediate:!0});let P;return z(()=>e.modelValue,t=>{!G(t,l.value)&&!G(t,P)&&(l.value=t.slice(0),P=t.slice(0))},{deep:!0}),z(l,t=>{G(t,e.modelValue)||(P=t.slice(0),a("update:modelValue",P))},{immediate:!0}),ie("touchmove",se,{target:c}),ce({confirm:H,getSelectedOptions:()=>p.value}),()=>{var t,o;return m("div",{class:x()},[e.toolbarPosition==="top"?I():null,e.loading?m(Pe,{class:x("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),j(),(o=n["columns-bottom"])==null?void 0:o.call(n),e.toolbarPosition==="bottom"?I():null])}}});const qe=Ie(je),Xe=C({},Q,{modelValue:D(),filter:Function,formatter:{type:Function,default:(e,a)=>a}}),Je=Object.keys(Q);function Le(e,a){if(e<0)return[];const n=Array(e);let c=-1;for(;++c<e;)n[c]=a(c);return n}const Qe=(e,a)=>32-new Date(e,a-1,32).getDate(),We=(e,a,n,c,l,d)=>{const r=Le(a-e+1,v=>{const u=re(e+v);return c(n,{text:u,value:u})});return l?l(n,r,d):r},et=(e,a)=>e.map((n,c)=>{const l=a[c];if(l.length){const d=+l[0].value,r=+l[l.length-1].value;return re($(+n,d,r))}return n});export{qe as P,Qe as a,et as f,We as g,Je as p,Xe as s};
