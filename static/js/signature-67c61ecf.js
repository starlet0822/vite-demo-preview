import{_ as $}from"./index-03d2b5ec.js";import{d as B,ae as R,a as w,r as N,o as z,an as G,w as I,f as y,k as C,x,s as T,p,q as f,F as V,G as q,A as j,z as X,I as D,g as Y,Y as H,u as L,X as J,al as K,am as Q,S as Z}from"./index-5560da19.js";import{C as tt}from"./index-462a24ae.js";import{_ as et}from"./index-fb7ed376.js";import{d as st}from"./file-a239f640.js";import{C as nt,R as it}from"./index-8ea4ee1f.js";import{I as F}from"./intro.module-83cad421.js";import{_ as O}from"./plugin-vue_export-helper-c27b6911.js";import{B as ot}from"./index-e0efa64a.js";import"./index-0e6beb51.js";import"./use-placeholder-87cf9818.js";import"./use-route-23f883a9.js";/*!
 * Signature Pad v4.1.6 | https://github.com/szimek/signature_pad
 * (c) 2023 Szymon Nowak | Released under the MIT license
 */class b{constructor(t,s,e,i){if(isNaN(t)||isNaN(s))throw new Error(`Point is invalid: (${t}, ${s})`);this.x=+t,this.y=+s,this.pressure=e||0,this.time=i||Date.now()}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}equals(t){return this.x===t.x&&this.y===t.y&&this.pressure===t.pressure&&this.time===t.time}velocityFrom(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):0}}class M{constructor(t,s,e,i,n,c){this.startPoint=t,this.control2=s,this.control1=e,this.endPoint=i,this.startWidth=n,this.endWidth=c}static fromPoints(t,s){const e=this.calculateControlPoints(t[0],t[1],t[2]).c2,i=this.calculateControlPoints(t[1],t[2],t[3]).c1;return new M(t[1],e,i,t[2],s.start,s.end)}static calculateControlPoints(t,s,e){const i=t.x-s.x,n=t.y-s.y,c=s.x-e.x,a=s.y-e.y,r={x:(t.x+s.x)/2,y:(t.y+s.y)/2},o={x:(s.x+e.x)/2,y:(s.y+e.y)/2},l=Math.sqrt(i*i+n*n),h=Math.sqrt(c*c+a*a),_=r.x-o.x,v=r.y-o.y,d=h/(l+h),g={x:o.x+_*d,y:o.y+v*d},k=s.x-g.x,E=s.y-g.y;return{c1:new b(r.x+k,r.y+E),c2:new b(o.x+k,o.y+E)}}length(){let s=0,e,i;for(let n=0;n<=10;n+=1){const c=n/10,a=this.point(c,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),r=this.point(c,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(n>0){const o=a-e,l=r-i;s+=Math.sqrt(o*o+l*l)}e=a,i=r}return s}point(t,s,e,i,n){return s*(1-t)*(1-t)*(1-t)+3*e*(1-t)*(1-t)*t+3*i*(1-t)*t*t+n*t*t*t}}class at{constructor(){try{this._et=new EventTarget}catch{this._et=document}}addEventListener(t,s,e){this._et.addEventListener(t,s,e)}dispatchEvent(t){return this._et.dispatchEvent(t)}removeEventListener(t,s,e){this._et.removeEventListener(t,s,e)}}function rt(m,t=250){let s=0,e=null,i,n,c;const a=()=>{s=Date.now(),e=null,i=m.apply(n,c),e||(n=null,c=[])};return function(...o){const l=Date.now(),h=t-(l-s);return n=this,c=o,h<=0||h>t?(e&&(clearTimeout(e),e=null),s=l,i=m.apply(n,c),e||(n=null,c=[])):e||(e=window.setTimeout(a,h)),i}}let ct=class W extends at{constructor(t,s={}){super(),this.canvas=t,this._drawningStroke=!1,this._isEmpty=!0,this._lastPoints=[],this._data=[],this._lastVelocity=0,this._lastWidth=0,this._handleMouseDown=e=>{e.buttons===1&&(this._drawningStroke=!0,this._strokeBegin(e))},this._handleMouseMove=e=>{this._drawningStroke&&this._strokeMoveUpdate(e)},this._handleMouseUp=e=>{e.buttons===1&&this._drawningStroke&&(this._drawningStroke=!1,this._strokeEnd(e))},this._handleTouchStart=e=>{if(e.cancelable&&e.preventDefault(),e.targetTouches.length===1){const i=e.changedTouches[0];this._strokeBegin(i)}},this._handleTouchMove=e=>{e.cancelable&&e.preventDefault();const i=e.targetTouches[0];this._strokeMoveUpdate(i)},this._handleTouchEnd=e=>{if(e.target===this.canvas){e.cancelable&&e.preventDefault();const n=e.changedTouches[0];this._strokeEnd(n)}},this._handlePointerStart=e=>{this._drawningStroke=!0,e.preventDefault(),this._strokeBegin(e)},this._handlePointerMove=e=>{this._drawningStroke&&(e.preventDefault(),this._strokeMoveUpdate(e))},this._handlePointerEnd=e=>{this._drawningStroke&&(e.preventDefault(),this._drawningStroke=!1,this._strokeEnd(e))},this.velocityFilterWeight=s.velocityFilterWeight||.7,this.minWidth=s.minWidth||.5,this.maxWidth=s.maxWidth||2.5,this.throttle="throttle"in s?s.throttle:16,this.minDistance="minDistance"in s?s.minDistance:5,this.dotSize=s.dotSize||0,this.penColor=s.penColor||"black",this.backgroundColor=s.backgroundColor||"rgba(0,0,0,0)",this.compositeOperation=s.compositeOperation||"source-over",this._strokeMoveUpdate=this.throttle?rt(W.prototype._strokeUpdate,this.throttle):W.prototype._strokeUpdate,this._ctx=t.getContext("2d"),this.clear(),this.on()}clear(){const{_ctx:t,canvas:s}=this;t.fillStyle=this.backgroundColor,t.clearRect(0,0,s.width,s.height),t.fillRect(0,0,s.width,s.height),this._data=[],this._reset(this._getPointGroupOptions()),this._isEmpty=!0}fromDataURL(t,s={}){return new Promise((e,i)=>{const n=new Image,c=s.ratio||window.devicePixelRatio||1,a=s.width||this.canvas.width/c,r=s.height||this.canvas.height/c,o=s.xOffset||0,l=s.yOffset||0;this._reset(this._getPointGroupOptions()),n.onload=()=>{this._ctx.drawImage(n,o,l,a,r),e()},n.onerror=h=>{i(h)},n.crossOrigin="anonymous",n.src=t,this._isEmpty=!1})}toDataURL(t="image/png",s){switch(t){case"image/svg+xml":return typeof s!="object"&&(s=void 0),`data:image/svg+xml;base64,${btoa(this.toSVG(s))}`;default:return typeof s!="number"&&(s=void 0),this.canvas.toDataURL(t,s)}}on(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",this.canvas.style.userSelect="none";const t=/Macintosh/.test(navigator.userAgent)&&"ontouchstart"in document;window.PointerEvent&&!t?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())}off(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.style.userSelect="auto",this.canvas.removeEventListener("pointerdown",this._handlePointerStart),this.canvas.removeEventListener("pointermove",this._handlePointerMove),this.canvas.ownerDocument.removeEventListener("pointerup",this._handlePointerEnd),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove),this.canvas.ownerDocument.removeEventListener("mouseup",this._handleMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove),this.canvas.removeEventListener("touchend",this._handleTouchEnd)}isEmpty(){return this._isEmpty}fromData(t,{clear:s=!0}={}){s&&this.clear(),this._fromData(t,this._drawCurve.bind(this),this._drawDot.bind(this)),this._data=this._data.concat(t)}toData(){return this._data}_getPointGroupOptions(t){return{penColor:t&&"penColor"in t?t.penColor:this.penColor,dotSize:t&&"dotSize"in t?t.dotSize:this.dotSize,minWidth:t&&"minWidth"in t?t.minWidth:this.minWidth,maxWidth:t&&"maxWidth"in t?t.maxWidth:this.maxWidth,velocityFilterWeight:t&&"velocityFilterWeight"in t?t.velocityFilterWeight:this.velocityFilterWeight,compositeOperation:t&&"compositeOperation"in t?t.compositeOperation:this.compositeOperation}}_strokeBegin(t){this.dispatchEvent(new CustomEvent("beginStroke",{detail:t}));const s=this._getPointGroupOptions(),e=Object.assign(Object.assign({},s),{points:[]});this._data.push(e),this._reset(s),this._strokeUpdate(t)}_strokeUpdate(t){if(this._data.length===0){this._strokeBegin(t);return}this.dispatchEvent(new CustomEvent("beforeUpdateStroke",{detail:t}));const s=t.clientX,e=t.clientY,i=t.pressure!==void 0?t.pressure:t.force!==void 0?t.force:0,n=this._createPoint(s,e,i),c=this._data[this._data.length-1],a=c.points,r=a.length>0&&a[a.length-1],o=r?n.distanceTo(r)<=this.minDistance:!1,l=this._getPointGroupOptions(c);if(!r||!(r&&o)){const h=this._addPoint(n,l);r?h&&this._drawCurve(h,l):this._drawDot(n,l),a.push({time:n.time,x:n.x,y:n.y,pressure:n.pressure})}this.dispatchEvent(new CustomEvent("afterUpdateStroke",{detail:t}))}_strokeEnd(t){this._strokeUpdate(t),this.dispatchEvent(new CustomEvent("endStroke",{detail:t}))}_handlePointerEvents(){this._drawningStroke=!1,this.canvas.addEventListener("pointerdown",this._handlePointerStart),this.canvas.addEventListener("pointermove",this._handlePointerMove),this.canvas.ownerDocument.addEventListener("pointerup",this._handlePointerEnd)}_handleMouseEvents(){this._drawningStroke=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove),this.canvas.ownerDocument.addEventListener("mouseup",this._handleMouseUp)}_handleTouchEvents(){this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove),this.canvas.addEventListener("touchend",this._handleTouchEnd)}_reset(t){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(t.minWidth+t.maxWidth)/2,this._ctx.fillStyle=t.penColor,this._ctx.globalCompositeOperation=t.compositeOperation}_createPoint(t,s,e){const i=this.canvas.getBoundingClientRect();return new b(t-i.left,s-i.top,e,new Date().getTime())}_addPoint(t,s){const{_lastPoints:e}=this;if(e.push(t),e.length>2){e.length===3&&e.unshift(e[0]);const i=this._calculateCurveWidths(e[1],e[2],s),n=M.fromPoints(e,i);return e.shift(),n}return null}_calculateCurveWidths(t,s,e){const i=e.velocityFilterWeight*s.velocityFrom(t)+(1-e.velocityFilterWeight)*this._lastVelocity,n=this._strokeWidth(i,e),c={end:n,start:this._lastWidth};return this._lastVelocity=i,this._lastWidth=n,c}_strokeWidth(t,s){return Math.max(s.maxWidth/(t+1),s.minWidth)}_drawCurveSegment(t,s,e){const i=this._ctx;i.moveTo(t,s),i.arc(t,s,e,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve(t,s){const e=this._ctx,i=t.endWidth-t.startWidth,n=Math.ceil(t.length())*2;e.beginPath(),e.fillStyle=s.penColor;for(let c=0;c<n;c+=1){const a=c/n,r=a*a,o=r*a,l=1-a,h=l*l,_=h*l;let v=_*t.startPoint.x;v+=3*h*a*t.control1.x,v+=3*l*r*t.control2.x,v+=o*t.endPoint.x;let d=_*t.startPoint.y;d+=3*h*a*t.control1.y,d+=3*l*r*t.control2.y,d+=o*t.endPoint.y;const g=Math.min(t.startWidth+o*i,s.maxWidth);this._drawCurveSegment(v,d,g)}e.closePath(),e.fill()}_drawDot(t,s){const e=this._ctx,i=s.dotSize>0?s.dotSize:(s.minWidth+s.maxWidth)/2;e.beginPath(),this._drawCurveSegment(t.x,t.y,i),e.closePath(),e.fillStyle=s.penColor,e.fill()}_fromData(t,s,e){for(const i of t){const{points:n}=i,c=this._getPointGroupOptions(i);if(n.length>1)for(let a=0;a<n.length;a+=1){const r=n[a],o=new b(r.x,r.y,r.pressure,r.time);a===0&&this._reset(c);const l=this._addPoint(o,c);l&&s(l,c)}else this._reset(c),e(n[0],c)}}toSVG({includeBackgroundColor:t=!1}={}){const s=this._data,e=Math.max(window.devicePixelRatio||1,1),i=0,n=0,c=this.canvas.width/e,a=this.canvas.height/e,r=document.createElementNS("http://www.w3.org/2000/svg","svg");if(r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttribute("viewBox",`${i} ${n} ${c} ${a}`),r.setAttribute("width",c.toString()),r.setAttribute("height",a.toString()),t&&this.backgroundColor){const o=document.createElement("rect");o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.setAttribute("fill",this.backgroundColor),r.appendChild(o)}return this._fromData(s,(o,{penColor:l})=>{const h=document.createElement("path");if(!isNaN(o.control1.x)&&!isNaN(o.control1.y)&&!isNaN(o.control2.x)&&!isNaN(o.control2.y)){const _=`M ${o.startPoint.x.toFixed(3)},${o.startPoint.y.toFixed(3)} C ${o.control1.x.toFixed(3)},${o.control1.y.toFixed(3)} ${o.control2.x.toFixed(3)},${o.control2.y.toFixed(3)} ${o.endPoint.x.toFixed(3)},${o.endPoint.y.toFixed(3)}`;h.setAttribute("d",_),h.setAttribute("stroke-width",(o.endWidth*2.25).toFixed(3)),h.setAttribute("stroke",l),h.setAttribute("fill","none"),h.setAttribute("stroke-linecap","round"),r.appendChild(h)}},(o,{penColor:l,dotSize:h,minWidth:_,maxWidth:v})=>{const d=document.createElement("circle"),g=h>0?h:(_+v)/2;d.setAttribute("r",g.toString()),d.setAttribute("cx",o.x.toString()),d.setAttribute("cy",o.y.toString()),d.setAttribute("fill",l),r.appendChild(d)}),r.outerHTML}};const lt={class:"signature"},ht={key:0,class:"tip-text st-font-24"},ut={class:"ctrl-color"},dt=["onClick"],_t={class:"ctrl-btn text-right"},mt=B({__name:"SignaturePad",props:{options:{type:Object,default:()=>({})}},emits:["save"],setup(m,{expose:t,emit:s}){const e=m;R(u=>({"19d5e87f":o.value}));const i=()=>{F().setOptions({prevLabel:"上一步",nextLabel:"下一步",skipLabel:"跳过",doneLabel:"知道了",showBullets:!1,disableInteraction:!0,exitOnOverlayClick:!1,steps:[{element:document.querySelector(".signature-wrapper"),title:"签名区域",intro:"您可以在此处手写签名",position:"top"},{element:document.querySelector(".ctrl-color"),title:"手写笔颜色",intro:"您可以切换手写笔颜色",position:"top"},{element:document.querySelector(".ctrl-btn"),title:"操作",intro:"您可以撤销、清空、保存签名",position:"bottom"},{element:document.querySelector(".preview"),title:"预览区域",intro:"您可以在此处预览签名效果",position:"top"}]}).start()},n=w(),c=w(null),a=w(null),r=w(!0),o=w("#000"),l=N(["#000","#2489f3","#ed521f"]),h=w(.5);z(()=>{_(),window.addEventListener("resize",E)}),G(()=>{var u;(u=F())==null||u.exit(),a.value=null,window.removeEventListener("resize",E)}),I(()=>a.value,u=>{r.value=u._isEmpty},{deep:!0});const _=()=>{const u={minWidth:h.value,maxWidth:5,penColor:o.value,backgroundColor:"rgb(255, 255, 255)"};a.value=new ct(c.value,{...u,...e.options}),r.value=a.value.isEmpty(),E(),a.value.addEventListener("beginStroke",()=>{r.value=!1},{once:!1})},v=()=>{const u=a.value.toData();u&&(u.pop(),a.value.fromData(u))},d=()=>{a.value.clear(),k()},g=u=>{a.value.penColor=o.value=u},k=()=>{if(a.value.isEmpty())s("save",null);else{const u=a.value.toDataURL();s("save",u)}};function E(){var u;c.value.width=(u=n.value)==null?void 0:u.offsetWidth,c.value.height=document.body.clientHeight/2,a.value.clear()}return t({guide:i}),(u,Et)=>{const A=nt,P=ot,U=it;return y(),C("div",lt,[x("section",{ref_key:"wrapperRef",ref:n,class:"signature-wrapper"},[r.value?(y(),C("h2",ht,"请在此处签名")):T("",!0),x("canvas",{ref_key:"canvasRef",ref:c},"您的浏览器不支持canvas技术,请升级浏览器!",512)],512),p(U,{type:"flex",justify:"space-between",class:"signature__control"},{default:f(()=>[p(A,{xs:12,sm:12,md:12,lg:8,xl:6},{default:f(()=>[x("div",ut,[(y(!0),C(V,null,q(l,S=>(y(),C("div",{key:S,style:j({"background-color":S}),class:X(["color-btn",{"active-color":S===o.value}]),onClick:Ct=>g(S)},null,14,dt))),128))])]),_:1}),p(A,{xs:12,sm:12,md:12,lg:8,xl:6},{default:f(()=>[x("div",_t,[p(P,{size:"small",disabled:r.value,onClick:v},{default:f(()=>[D("撤 销")]),_:1},8,["disabled"]),p(P,{size:"small",type:"danger",disabled:r.value,onClick:d},{default:f(()=>[D(" 清 空 ")]),_:1},8,["disabled"]),p(P,{size:"small",type:"primary",disabled:r.value,onClick:k},{default:f(()=>[D(" 预 览 ")]),_:1},8,["disabled"])])]),_:1})]),_:1})])}}}),pt=O(mt,[["__scopeId","data-v-5e4e8bb6"]]);const vt=m=>(K("data-v-9d12899c"),m=m(),Q(),m),ft=vt(()=>x("span",{class:"st-margin-right-10"},"签名教程",-1)),gt={key:0,class:"preview"},wt=["src"],yt=B({name:"Signature"}),xt=Object.assign(yt,{setup(m){const t=w(null),s=w(null),e=()=>{s.value.guide()},i=()=>{},n=a=>{if(t.value=a,!t.value)return!1},c=()=>{if(!t.value)return Z({message:"下载失败，要先签名哦~"}),!1;st(t.value,"mySign.png")};return(a,r)=>{const o=J,l=et,h=tt,_=$;return y(),Y(_,{class:"page-wrapper"},{header:f(()=>[p(l,null,{right:f(()=>[x("div",{class:"guide-icon st-font-12 st-flex-ai",onClick:e},[ft,p(o,{name:"info"})])]),_:1})]),default:f(()=>[x("div",null,[p(h,{title:"手写签名区域",border:!1}),p(pt,{ref_key:"signaturePadRef",ref:s,onSave:n},null,512),(y(),C("div",gt,[p(h,{title:"预览签名区域",center:""},H({_:2},[void 0]),1024),L(t)?(y(),C("img",{key:0,class:"sign-img",src:L(t),onClick:i},null,8,wt)):T("",!0)]))])]),_:1})}}}),Ot=O(xt,[["__scopeId","data-v-9d12899c"]]);export{Ot as default};
