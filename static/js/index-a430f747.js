import{a1 as V,cv as Te,a2 as w,ay as J,d as R,a3 as L,ct as N,cb as $,a as S,cy as xe,c as C,a5 as oe,cl as le,e as Oe,cf as ce,p as r,cz as ie,cF as X,av as D,c5 as se,c7 as Q,ax as pe,au as Ce,c_ as ke,w as j,cI as z,ar as ye,B as Z,m as Pe,da as Se,a7 as we}from"./index-9fff26e3.js";import{u as Ee}from"./use-sync-prop-ref-ecf9d229.js";import{a as Ie,T as Be}from"./index-05c91559.js";const[He,x,ee]=V("picker"),ue=e=>e.find(o=>!o.disabled)||e[0];function Me(e,o){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(o.children in n)return"cascade"}return"default"}function _(e,o){o=J(o,0,e.length);for(let n=o;n<e.length;n++)if(!e[n].disabled)return n;for(let n=o-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const te=(e,o,n)=>o!==void 0&&!!e.find(i=>i[n.value]===o);function W(e,o,n){const i=e.findIndex(v=>v[n.value]===o),c=_(e,i);return e[c]}function Ne(e,o,n){const i=[];let c={[o.children]:e},v=0;for(;c&&c[o.children];){const m=c[o.children],h=n.value[v];if(c=Te(h)?W(m,h,o):void 0,!c&&m.length){const u=ue(m)[o.value];c=W(m,u,o)}v++,i.push(m)}return i}function De(e){const{transform:o}=window.getComputedStyle(e),n=o.slice(7,o.length-1).split(", ")[5];return Number(n)}function _e(e){return w({text:"text",value:"value",children:"children"},e)}const ne=200,ae=300,$e=15,[re,G]=V("picker-column"),de=Symbol(re);var Ve=R({name:re,props:{value:L,fields:N(Object),options:$(),readonly:Boolean,allowHtml:Boolean,optionHeight:N(Number),swipeDuration:N(L),visibleOptionNum:N(L)},emits:["change","clickOption","scrollInto"],setup(e,{emit:o,slots:n}){let i,c,v,m,h;const u=S(),b=S(),d=S(0),f=S(0),g=xe(),O=()=>e.options.length,H=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,k=s=>{let t=_(e.options,s);const a=-t*e.optionHeight,l=()=>{t>O()-1&&(t=_(e.options,s));const p=e.options[t][e.fields.value];p!==e.value&&o("change",p)};i&&a!==d.value?h=l:l(),d.value=a},T=()=>e.readonly||!e.options.length,F=s=>{i||T()||(h=null,f.value=ne,k(s),o("clickOption",e.options[s]))},y=s=>J(Math.round(-s/e.optionHeight),0,O()-1),M=C(()=>y(d.value)),U=(s,t)=>{const a=Math.abs(s/t);s=d.value+a/.003*(s<0?-1:1);const l=y(s);f.value=+e.swipeDuration,k(l)},E=()=>{i=!1,f.value=0,h&&(h(),h=null)},K=s=>{if(!T()){if(g.start(s),i){const t=De(b.value);d.value=Math.min(0,t-H())}f.value=0,c=d.value,v=Date.now(),m=c,h=null}},Y=s=>{if(T())return;g.move(s),g.isVertical()&&(i=!0,ie(s,!0));const t=J(c+g.deltaY.value,-(O()*e.optionHeight),e.optionHeight),a=y(t);a!==M.value&&o("scrollInto",e.options[a]),d.value=t;const l=Date.now();l-v>ae&&(v=l,m=t)},I=()=>{if(T())return;const s=d.value-m,t=Date.now()-v;if(t<ae&&Math.abs(s)>$e){U(s,t);return}const l=y(d.value);f.value=ne,k(l),setTimeout(()=>{i=!1},0)},P=()=>{const s={height:`${e.optionHeight}px`};return e.options.map((t,a)=>{const l=t[e.fields.text],{disabled:p}=t,B=t[e.fields.value],be={role:"button",style:s,tabindex:p?-1:0,class:[G("item",{disabled:p,selected:B===e.value}),t.className],onClick:()=>F(a)},ge={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return r("li",be,[n.option?n.option(t,a):r("div",ge,null)])})};return oe(de),le({stopMomentum:E}),Oe(()=>{const s=i?Math.floor(-d.value/e.optionHeight):e.options.findIndex(l=>l[e.fields.value]===e.value),t=_(e.options,s),a=-t*e.optionHeight;i&&t<s&&E(),d.value=a}),ce("touchmove",Y,{target:u}),()=>r("div",{ref:u,class:G(),onTouchstartPassive:K,onTouchend:I,onTouchcancel:I},[r("ul",{ref:b,style:{transform:`translate3d(0, ${d.value+H()}px, 0)`,transitionDuration:`${f.value}ms`,transitionProperty:f.value?"all":"none"},class:G("wrapper"),onTransitionend:E},[P()])])}});const[Re]=V("picker-toolbar"),A={title:String,cancelButtonText:String,confirmButtonText:String},me=["cancel","confirm","title","toolbar"],Ae=Object.keys(A);var fe=R({name:Re,props:A,emits:["confirm","cancel"],setup(e,{emit:o,slots:n}){const i=()=>{if(n.title)return n.title();if(e.title)return r("div",{class:[x("title"),"van-ellipsis"]},[e.title])},c=()=>o("cancel"),v=()=>o("confirm"),m=()=>{const u=e.cancelButtonText||ee("cancel");return r("button",{type:"button",class:[x("cancel"),X],onClick:c},[n.cancel?n.cancel():u])},h=()=>{const u=e.confirmButtonText||ee("confirm");return r("button",{type:"button",class:[x("confirm"),X],onClick:v},[n.confirm?n.confirm():u])};return()=>r("div",{class:x("toolbar")},[n.toolbar?n.toolbar():[m(),i(),h()]])}});const[ve,q]=V("picker-group"),he=Symbol(ve),Fe=w({tabs:$(),activeTab:D(0),nextStepText:String},A);R({name:ve,props:Fe,emits:["confirm","cancel","update:activeTab"],setup(e,{emit:o,slots:n}){const i=Ee(()=>e.activeTab,b=>o("update:activeTab",b)),{children:c,linkChildren:v}=se(he);v();const m=()=>+i.value<e.tabs.length-1&&e.nextStepText,h=()=>{m()?i.value=+i.value+1:o("confirm",c.map(b=>b.confirm()))},u=()=>o("cancel");return()=>{var b;const d=(b=n.default)==null?void 0:b.call(n),f=m()?e.nextStepText:e.confirmButtonText;return r("div",{class:q()},[r(fe,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:f,onConfirm:h,onCancel:u},Q(n,me)),r(Ie,{active:i.value,"onUpdate:active":g=>i.value=g,class:q("tabs"),shrink:!0,animated:!0,lazyRender:!1},{default:()=>[e.tabs.map((g,O)=>r(Be,{title:g,titleClass:q("tab-title")},{default:()=>[d==null?void 0:d[O]]}))]})])}}});const Ue=w({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:D(44),showToolbar:pe,swipeDuration:D(1e3),visibleOptionNum:D(6)},A),Ke=w({},Ue,{columns:$(),modelValue:$(),toolbarPosition:Ce("top"),columnsFieldNames:Object});var Ye=R({name:He,props:Ke,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:o,slots:n}){const i=S(),c=S(e.modelValue.slice(0)),{parent:v}=oe(he),{children:m,linkChildren:h}=se(de);h();const u=C(()=>_e(e.columnsFieldNames)),b=C(()=>ke(e.optionHeight)),d=C(()=>Me(e.columns,u.value)),f=C(()=>{const{columns:t}=e;switch(d.value){case"multiple":return t;case"cascade":return Ne(t,u.value,c);default:return[t]}}),g=C(()=>f.value.some(t=>t.length)),O=C(()=>f.value.map((t,a)=>W(t,c.value[a],u.value))),H=C(()=>f.value.map((t,a)=>t.findIndex(l=>l[u.value.value]===c.value[a]))),k=(t,a)=>{if(c.value[t]!==a){const l=c.value.slice(0);l[t]=a,c.value=l}},T=()=>({selectedValues:c.value.slice(0),selectedOptions:O.value,selectedIndexes:H.value}),F=(t,a)=>{k(a,t),d.value==="cascade"&&c.value.forEach((l,p)=>{const B=f.value[p];te(B,l,u.value)||k(p,B.length?B[0][u.value.value]:void 0)}),Z(()=>{o("change",w({columnIndex:a},T()))})},y=(t,a)=>{const l={columnIndex:a,currentOption:t};o("clickOption",w(T(),l)),o("scrollInto",l)},M=()=>{m.forEach(a=>a.stopMomentum());const t=T();return Z(()=>{o("confirm",t)}),t},U=()=>o("cancel",T()),E=()=>f.value.map((t,a)=>r(Ve,{value:c.value[a],fields:u.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:b.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:l=>F(l,a),onClickOption:l=>y(l,a),onScrollInto:l=>{o("scrollInto",{currentOption:l,columnIndex:a})}},{option:n.option})),K=t=>{if(g.value){const a={height:`${b.value}px`},l={backgroundSize:`100% ${(t-b.value)/2}px`};return[r("div",{class:x("mask"),style:l},null),r("div",{class:[Se,x("frame")],style:a},null)]}},Y=()=>{const t=b.value*+e.visibleOptionNum,a={height:`${t}px`};return r("div",{ref:i,class:x("columns"),style:a},[E(),K(t)])},I=()=>{if(e.showToolbar&&!v)return r(fe,Pe(Q(e,Ae),{onConfirm:M,onCancel:U}),Q(n,me))};j(f,t=>{t.forEach((a,l)=>{a.length&&!te(a,c.value[l],u.value)&&k(l,ue(a)[u.value.value])})},{immediate:!0});let P;return j(()=>e.modelValue,t=>{!z(t,c.value)&&!z(t,P)&&(c.value=t.slice(0),P=t.slice(0))},{deep:!0}),j(c,t=>{z(t,e.modelValue)||(P=t.slice(0),o("update:modelValue",P))},{immediate:!0}),ce("touchmove",ie,{target:i}),le({confirm:M,getSelectedOptions:()=>O.value}),()=>{var t,a;return r("div",{class:x()},[e.toolbarPosition==="top"?I():null,e.loading?r(ye,{class:x("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),Y(),(a=n["columns-bottom"])==null?void 0:a.call(n),e.toolbarPosition==="bottom"?I():null])}}});const Ge=we(Ye);export{Ge as P,Ue as p};
