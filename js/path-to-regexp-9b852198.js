function e(e,n){void 0===n&&(n={});for(var r=function(e){for(var t=[],n=0;n<e.length;){var r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{var i=1,a="";if("?"===e[c=n+1])throw new TypeError('Pattern cannot start with "?" at '.concat(c));for(;c<e.length;)if("\\"!==e[c]){if(")"===e[c]){if(0==--i){c++;break}}else if("("===e[c]&&(i++,"?"!==e[c+1]))throw new TypeError("Capturing groups are not allowed at ".concat(c));a+=e[c++]}else a+=e[c++]+e[c++];if(i)throw new TypeError("Unbalanced pattern at ".concat(n));if(!a)throw new TypeError("Missing pattern at ".concat(n));t.push({type:"PATTERN",index:n,value:a}),n=c}else{for(var o="",c=n+1;c<e.length;){var f=e.charCodeAt(c);if(!(f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||95===f))break;o+=e[c++]}if(!o)throw new TypeError("Missing parameter name at ".concat(n));t.push({type:"NAME",index:n,value:o}),n=c}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),i=n.prefixes,a=void 0===i?"./":i,o="[^".concat(t(n.delimiter||"/#?"),"]+?"),c=[],f=0,u=0,p="",s=function(e){if(u<r.length&&r[u].type===e)return r[u++].value},d=function(e){var t=s(e);if(void 0!==t)return t;var n=r[u],i=n.type,a=n.index;throw new TypeError("Unexpected ".concat(i," at ").concat(a,", expected ").concat(e))},v=function(){for(var e,t="";e=s("CHAR")||s("ESCAPED_CHAR");)t+=e;return t};u<r.length;){var l=s("CHAR"),h=s("NAME"),E=s("PATTERN");if(h||E){var x=l||"";-1===a.indexOf(x)&&(p+=x,x=""),p&&(c.push(p),p=""),c.push({name:h||f++,prefix:x,suffix:"",pattern:E||o,modifier:s("MODIFIER")||""})}else{var m=l||s("ESCAPED_CHAR");if(m)p+=m;else if(p&&(c.push(p),p=""),s("OPEN")){x=v();var y=s("NAME")||"",g=s("PATTERN")||"",A=v();d("CLOSE"),c.push({name:y||(g?f++:""),pattern:y&&!g?o:g,prefix:x,suffix:A,modifier:s("MODIFIER")||""})}else d("END")}}return c}function t(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function n(e){return e&&e.sensitive?"":"i"}function r(r,i,a){return function(e,r,i){void 0===i&&(i={});for(var a=i.strict,o=void 0!==a&&a,c=i.start,f=void 0===c||c,u=i.end,p=void 0===u||u,s=i.encode,d=void 0===s?function(e){return e}:s,v=i.delimiter,l=void 0===v?"/#?":v,h=i.endsWith,E="[".concat(t(void 0===h?"":h),"]|$"),x="[".concat(t(l),"]"),m=f?"^":"",y=0,g=e;y<g.length;y++){var A=g[y];if("string"==typeof A)m+=t(d(A));else{var w=t(d(A.prefix)),R=t(d(A.suffix));if(A.pattern)if(r&&r.push(A),w||R)if("+"===A.modifier||"*"===A.modifier){var C="*"===A.modifier?"?":"";m+="(?:".concat(w,"((?:").concat(A.pattern,")(?:").concat(R).concat(w,"(?:").concat(A.pattern,"))*)").concat(R,")").concat(C)}else m+="(?:".concat(w,"(").concat(A.pattern,")").concat(R,")").concat(A.modifier);else"+"===A.modifier||"*"===A.modifier?m+="((?:".concat(A.pattern,")").concat(A.modifier,")"):m+="(".concat(A.pattern,")").concat(A.modifier);else m+="(?:".concat(w).concat(R,")").concat(A.modifier)}}if(p)o||(m+="".concat(x,"?")),m+=i.endsWith?"(?=".concat(E,")"):"$";else{var T=e[e.length-1],N="string"==typeof T?x.indexOf(T[T.length-1])>-1:void 0===T;o||(m+="(?:".concat(x,"(?=").concat(E,"))?")),N||(m+="(?=".concat(x,"|").concat(E,")"))}return new RegExp(m,n(i))}(e(r,a),i,a)}function i(e,t,a){return e instanceof RegExp?function(e,t){if(!t)return e;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,i=n.exec(e.source);i;)t.push({name:i[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),i=n.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,r){var a=e.map((function(e){return i(e,t,r).source}));return new RegExp("(?:".concat(a.join("|"),")"),n(r))}(e,t,a):r(e,t,a)}export{i as p};
